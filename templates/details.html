{{>doctype}}
<html>
    {{>header}}
    <body>
        {{>mainmenu}}
        <style>
            body { min-width:820px; }
            body, ul { padding:0; margin:0; border: 0; }
            ul { list-style-type:none; }
            .same-host {
                margin:15px 15px 15px 0;
                float:right;
                width:22%;
                text-align:center;
                max-width:240px;
                border-left:1px solid #bbb;
            }
            .same-host a, .same-host a:visited, .same-host a:hover {
                text-decoration:none;
                color:#2E83FF;
            }
            .same-host .current
            {
                border-bottom:1px solid #bbb;
                font-weight:bold;
            }
            .content{
                float:left;
                width:70%;
                margin:15px 0 15px 15px;
            }
        </style>
        
        <div class="content">
            {{#doc}}
            <ul>
                <li><label>Host:</label> {{host}}<li>
                <li><label>Date:</label> {{date}}<li>
                <li><label>Url:</label> {{url}}<li>
                <li><label>Server:</label> {{server}}<li>
                <li>
                    <label>Cookies:</label>
                    <ul class="cookies">
                        {{#cookies}}<li><strong>{{key}}=</strong><textarea readonly="readonly">{{val}}</textarea></li>{{/cookies}}
                    </ul>
                <li>
            </ul>
            {{/doc}}
        </div>
        <ul class="same-host"></ul>
        <script src="{{loader_js}}"></script>
        <script>
            $(function() {
                var host = '{{#doc}}{{host}}{{/doc}}';
                var id = '{{#doc}}{{_id}}{{/doc}}';
                if(host) {
                    $.couch.db("xss").view("api/items-by-host", {
                        key:host,
                        success : function(data) {
                            if(data && data.rows) {
                                var rows = data.rows;
                                var len = rows.length;
                                var records = [];
                                var detailsUrl = '{{detailsUrl}}';
                                for(var i = 0; i < len; i++) {
                                    var r = rows[i];
                                    records.push({
                                        id : r.id,
                                        date : r.value.date,
                                        url : detailsUrl + "/" + r.id,
                                        current : r.id == id
                                    });
                                }
                                var template = [
"[[#records]]",
"<li id='[[id]]'>",
"[[^current]]<a href='[[url]]'>[[date]]</a>[[/current]]",
"[[#current]]<span class='current'>[[date]]</span>[[/current]]",
"</li>",
"[[/records]]"].join('').replace(/\[/g, '{').replace(/\]/g, '}');

                                $(".same-host").empty()
                                    .append($.mustache(template, {records:records}));
                            }
                        }
                    });
                }
            });
        </script>
    </body>
</html>
